#############
#  general  #
#############

set -g base-index 1
set -g renumber-windows on
set -g mouse on
set -g history-limit 50000
set -g display-time 4000
set -g default-terminal "screen-256color"

if '[ "$TERM_PROGRAM" != "iTerm.app" ]' 'setw -g aggressive-resize on'

#################
#  keybindings  #
#################

set-option -g mode-keys vi

# change prefix
unbind C-b
set -g prefix C-z
bind C-z switch-client -T vi-normal
bind -T vi-normal C-z send-prefix

bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" \
  "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

####################
#  vi-normal mode  #
####################

bind -T vi-normal k select-pane -U \; switch-client -T vi-normal
bind -T vi-normal j select-pane -D \; switch-client -T vi-normal
bind -T vi-normal h select-pane -L \; switch-client -T vi-normal
bind -T vi-normal l select-pane -R \; switch-client -T vi-normal
bind -T vi-normal K resize-pane -U \; switch-client -T vi-normal
bind -T vi-normal J resize-pane -D \; switch-client -T vi-normal
bind -T vi-normal H resize-pane -L \; switch-client -T vi-normal
bind -T vi-normal L resize-pane -R \; switch-client -T vi-normal
bind -T vi-normal C-k swap-pane -U \; switch-client -T vi-normal
bind -T vi-normal C-j swap-pane -D \; switch-client -T vi-normal
bind -T vi-normal g switch-client -T vi-g
bind -T vi-normal G display-panes \; switch-client -T vi-normal

bind -T vi-normal c switch-client -T vi-c
bind -T vi-normal d switch-client -T vi-d
bind -T vi-normal m select-pane -m \; switch-client -T vi-normal
bind -T vi-normal p paste-buffer \; switch-client -T vi-normal
bind -T vi-normal t clock-mode \; switch-client -T vi-normal
bind -T vi-normal x confirm-before -p "kill-pane #P? (y/n)" kill-pane \;\
  switch-client -T vi-normal
bind -T vi-normal X confirm-before -p "kill-window #W? (y/n)" kill-window \;\
  switch-client -T vi-normal
bind -T vi-normal y copy-mode
bind -T vi-normal Z switch-client -T vi-Z
bind -T vi-normal C-g display-message \; switch-client -T vi-normal
bind -T vi-normal C-l refresh-client \; switch-client -T vi-normal
bind -T vi-normal C-o if-shell '[ #{window_panes} -gt 1 ]' last-pane last-window \;\
  switch-client -T vi-normal
bind -T vi-normal C-w switch-client -T vi-ctrl-w
bind -T vi-normal "'" command-prompt -p index "select-window -t ':%%'"
bind -T vi-normal '"' choose-buffer \; switch-client -T vi-normal
bind -T vi-normal : command-prompt \; switch-client -T vi-normal
bind -T vi-normal ? list-keys \; switch-client -T vi-normal
bind -T vi-normal Space next-layout \; switch-client -T vi-normal

###############
#  vi-c mode  #
###############

bind -T vi-c s command-prompt -I "#S" "rename-session '%%'" \;\
  switch-client -T vi-normal
bind -T vi-c w command-prompt -I "#W" "rename-window '%%'" \;\
  switch-client -T vi-normal

###############
#  vi-d mode  #
###############

bind -T vi-d b delete-buffer \; switch-client -T vi-normal
bind -T vi-d m select-pane -M \; switch-client -T vi-normal
bind -T vi-d w confirm-before -p "kill-window #W? (y/n)" kill-window \;\
  switch-client -T vi-normal

###############
#  vi-g mode  #
###############

bind -T vi-g 0 select-window -t :0 \; switch-client -T vi-normal
bind -T vi-g 1 select-window -t :1 \; switch-client -T vi-normal
bind -T vi-g 2 select-window -t :2 \; switch-client -T vi-normal
bind -T vi-g 3 select-window -t :3 \; switch-client -T vi-normal
bind -T vi-g 4 select-window -t :4 \; switch-client -T vi-normal
bind -T vi-g 5 select-window -t :5 \; switch-client -T vi-normal
bind -T vi-g 6 select-window -t :6 \; switch-client -T vi-normal
bind -T vi-g 7 select-window -t :7 \; switch-client -T vi-normal
bind -T vi-g 8 select-window -t :8 \; switch-client -T vi-normal
bind -T vi-g 9 select-window -t :9 \; switch-client -T vi-normal
bind -T vi-g b choose-tree
bind -T vi-g s switch-client -n \; switch-client -T vi-normal
bind -T vi-g S switch-client -p \; switch-client -T vi-normal
bind -T vi-g t next-window \; switch-client -T vi-normal
bind -T vi-g T previous-window \; switch-client -T vi-normal

###############
#  vi-Z mode  #
###############

bind -T vi-Z C choose-client
bind -T vi-Z Z suspend-client
bind -T vi-Z Q detach-client

####################
#  vi-ctrl-w mode  #
####################

bind -T vi-ctrl-w K resize-pane -U 5 \; switch-client -T vi-normal
bind -T vi-ctrl-w J resize-pane -D 5 \; switch-client -T vi-normal
bind -T vi-ctrl-w H resize-pane -L 5 \; switch-client -T vi-normal
bind -T vi-ctrl-w L resize-pane -R 5 \; switch-client -T vi-normal

bind -T vi-ctrl-w c new-window \; switch-client -T vi-normal
bind -T vi-ctrl-w o confirm-before -p "kill panes? (y/n)" "kill-pane -a" \;\
  switch-client -T vi-normal
bind -T vi-ctrl-w r rotate-window -D \; switch-client -T vi-normal
bind -T vi-ctrl-w s split-window -v \; switch-client -T vi-normal
bind -T vi-ctrl-w v split-window -h \; switch-client -T vi-normal
bind -T vi-ctrl-w w select-pane -t :.+ \; switch-client -T vi-normal
bind -T vi-ctrl-w z resize-pane -Z \; switch-client -T vi-normal
bind -T vi-ctrl-w R rotate-window \; switch-client -T vi-normal
bind -T vi-ctrl-w T break-pane \; switch-client -T vi-normal
bind -T vi-ctrl-w / command-prompt "find-window '%%'"
bind -T vi-ctrl-w C-o confirm-before -p "kill panes? (y/n)" "kill-pane -a" \;\
  switch-client -T vi-normal
bind -T vi-ctrl-w C-r rotate-window \; switch-client -T vi-normal
bind -T vi-ctrl-w C-s split-window -v \; switch-client -T vi-normal
bind -T vi-ctrl-w C-v split-window -h \; switch-client -T vi-normal
bind -T vi-ctrl-w C-w select-pane -t :.+ \; switch-client -T vi-normal
bind -T vi-ctrl-w C-z resize-pane -Z \; switch-client -T vi-normal
